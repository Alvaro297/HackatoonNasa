<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>CASIOPEA - DEBUG</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
	<style>
		body {
			font-family: 'Orbitron', monospace;
			background: #000;
			color: #fff;
			margin: 0;
			padding: 20px;
		}
		
		.header {
			text-align: center;
			margin-bottom: 30px;
		}
		
		.status {
			background: rgba(255, 255, 255, 0.1);
			border: 1px solid #4CAF50;
			border-radius: 10px;
			padding: 20px;
			margin: 20px 0;
		}
		
		.error {
			border-color: #f44336;
			background: rgba(255, 68, 68, 0.1);
		}
		
		.success {
			border-color: #4CAF50;
			background: rgba(76, 175, 80, 0.1);
		}
		
		button {
			background: #4CAF50;
			color: white;
			border: none;
			padding: 10px 20px;
			border-radius: 5px;
			cursor: pointer;
			margin: 10px;
			font-family: 'Orbitron', monospace;
		}
		
		button:hover {
			background: #45a049;
		}
		
		pre {
			background: rgba(255, 255, 255, 0.05);
			padding: 15px;
			border-radius: 5px;
			overflow-x: auto;
			font-size: 12px;
		}
		
		.loading {
			color: #4CAF50;
			font-style: italic;
		}
	</style>
</head>
<body>
	<div class="header">
		<h1>üõ°Ô∏è CASIOPEA - Debug Mode</h1>
		<p>Depurando conexi√≥n con API de NASA</p>
	</div>
	
	<button onclick="testBackendConnection()">üîó Test Backend Connection</button>
	<button onclick="testNASAConnection()">üõ∞Ô∏è Test NASA API</button>
	<button onclick="testWithDates()">üìÖ Test with Dates</button>
	<button onclick="clearResults()">üóëÔ∏è Clear Results</button>
	
	<div id="results"></div>

	<script>
		const API_URL = 'http://127.0.0.1:5001/api/data';
		const NASA_API_KEY = 'p0ydAYmUZc3uKXRUAz381Ew2uzFbkdAECmOgX1ep';

		function log(message, type = 'info') {
			console.log(`[${type.toUpperCase()}]`, message);
			
			const results = document.getElementById('results');
			const div = document.createElement('div');
			div.className = `status ${type}`;
			
			const time = new Date().toLocaleTimeString();
			div.innerHTML = `
				<h3>[${time}] ${type.toUpperCase()}</h3>
				<pre>${typeof message === 'object' ? JSON.stringify(message, null, 2) : message}</pre>
			`;
			
			results.appendChild(div);
			results.scrollTop = results.scrollHeight;
		}

		function clearResults() {
			document.getElementById('results').innerHTML = '';
		}

		async function testBackendConnection() {
			log('üîÑ Probando conexi√≥n b√°sica con backend...');
			
			try {
				const response = await fetch(API_URL, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						invented: true,
						diameter_m: 100,
						velocity_kms: 20,
						impact_angle_deg: 45,
						name: 'Debug Test'
					})
				});

				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}

				const data = await response.json();
				log('‚úÖ Backend conectado correctamente!', 'success');
				log(data, 'success');
				
			} catch (error) {
				log(`‚ùå Error conectando con backend: ${error.message}`, 'error');
				log(error, 'error');
			}
		}

		async function testNASAConnection() {
			log('üõ∞Ô∏è Probando conexi√≥n con API de NASA (browse)...');
			
			try {
				const response = await fetch(API_URL, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						api_key: NASA_API_KEY
					})
				});

				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}

				const data = await response.json();
				log('‚úÖ NASA API conectada correctamente!', 'success');
				log(`üìä Total asteroides: ${data.total_meteors}`, 'success');
				log(`‚ö†Ô∏è Peligrosos: ${data.hazardous_count}`, 'success');
				log(`üöÄ Primeros 3 asteroides:`, 'success');
				log(data.meteors.slice(0, 3), 'success');
				
			} catch (error) {
				log(`‚ùå Error conecting with NASA: ${error.message}`, 'error');
				log(error, 'error');
			}
		}

		async function testWithDates() {
			log('üìÖ Probando con rango de fechas...');
			
			try {
				const today = new Date().toISOString().split('T')[0];
				const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
				
				log(`üìä Consultando desde ${weekAgo} hasta ${today}`);
				
				const response = await fetch(API_URL, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						start_date: weekAgo,
						end_date: today,
						api_key: NASA_API_KEY
					})
				});

				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}

				const data = await response.json();
				log('‚úÖ Consulta por fechas exitosa!', 'success');
				log(`üìä Total asteroides: ${data.total_meteors}`, 'success');
				log(`‚ö†Ô∏è Peligrosos: ${data.hazardous_count}`, 'success');
				log(`üöÄ Primeros 5 asteroides:`, 'success');
				log(data.meteors.slice(0, 5), 'success');
				
			} catch (error) {
				log(`‚ùå Error en consulta por fechas: ${error.message}`, 'error');
				log(error, 'error');
			}
		}

		// Test autom√°tico al cargar
		window.onload = function() {
			log('üöÄ CASIOPEA Debug Mode iniciado');
			log('üîß Listo para pruebas de conexi√≥n');
		};
	</script>
</body>
</html>